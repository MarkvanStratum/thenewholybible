<!DOCTYPE html>
<html lang="da">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sikker Checkout</title>
  <meta name="referrer" content="no-referrer">

  <style>
    /* ‚Äî SAME CSS AS atlas2-cz.html ‚Äî */
    :root{
      --bg:#fafafa; --text:#0a2540; --muted:#5b6b82; --line:#e5e7eb; --card:#ffffff;
      --green:#18a957; --accent:#0f9d58; --accent2:#2dd4bf; --warn:#d30000;
      --radius:14px;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);font-family:Inter,system-ui,sans-serif;color:var(--text);}
    .wrap{max-width:1100px;margin:0 auto;padding:18px 14px 60px}
    .safe{background:#0a0a0a;color:#fff;padding:6px 10px;font-size:12px}
    .grid{display:grid;grid-template-columns:minmax(0,1fr) 360px;gap:18px;}
    @media(max-width:980px){.grid{grid-template-columns:1fr}}
    .card{background:#fff;border:1px solid var(--line);padding:22px;border-radius:12px;}
    .page-title{font-size:28px;font-weight:900;margin:6px 0 14px;display:flex;gap:8px}
    .stars{color:#f6b80c;font-size:15px}
    .reviews{color:var(--muted);font-size:13px;margin-left:6px}
    .h2{font-size:18px;font-weight:800;margin:10px 0 14px}
    .sub{font-size:13px;color:#5b6b82}
    .form-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    @media(max-width:620px){.form-grid{grid-template-columns:1fr}}
    .input,.select,.el{width:100%;border:1px solid #cfd6e4;padding:12px;border-radius:10px;font-size:15px}
    .btn{width:100%;padding:12px;border:none;border-radius:12px;background:#16a34a;color:#fff;font-weight:900;cursor:pointer}
    .logos{display:flex;gap:10px;margin-top:12px}
    .logos img{height:20px}
    .err{display:none;background:#fff1f1;border:1px solid #f5bcbc;padding:10px;border-radius:10px;margin-top:10px;color:#9a1a1a}
    .err[aria-hidden="false"]{display:block}
    .step{display:none}
    .step[aria-hidden="false"]{display:block}

    /* Loading overlay */
    .loading-overlay{
      position:fixed; inset:0; background:rgba(246,249,252,.92);
      display:none; align-items:center; justify-content:center; z-index:9999;
    }
    .loading-box{background:#fff;padding:24px;border-radius:14px;text-align:center;border:1px solid #e6edf5;box-shadow:0 6px 18px rgba(0,0,0,0.06)}
    .loading-title{font-size:20px;font-weight:800;margin-bottom:18px;color:#2a3b55}
    .progress-wrap{width:100%;height:12px;background:#ecf1f8;border-radius:999px;overflow:hidden}
    .progress-bar{height:100%;width:0%;background:linear-gradient(90deg,#7aa3ff,#2dd4bf);animation:loadingBar 2.2s ease-in-out infinite}
    @keyframes loadingBar{0%{width:0}60%{width:80%}100%{width:100}}
  </style>
</head>

<body>
<div class="safe">SSL Sikker Betaling</div>

<div class="wrap">
  <div class="page-title">
    Sikker Checkout üîí <span class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span>
    <span class="reviews">(2777 anmeldelser)</span>
  </div>

  <div class="grid">
    <!-- LEFT -->
    <div class="card">

      <!-- STEP 1 -->
      <section id="step1" class="step" aria-hidden="false">
        <div class="h2">1. Leveringsoplysninger</div>

        <div class="form-grid">
          <div><div class="label">Fornavn</div><input id="firstName" class="input"></div>
          <div><div class="label">Efternavn</div><input id="lastName" class="input"></div>
        </div>

        <div class="form-grid">
          <div style="grid-column:1 / -1"><div class="label">Adresse</div><input id="billingStreet" class="input"></div>
          <div><div class="label">Postnummer</div><input id="billingPostcode" class="input"></div>
          <div><div class="label">By</div><input id="billingCity" class="input"></div>
        </div>

        <div class="form-grid">
          <div><div class="label">E-mail</div><input id="emailInput" class="input" type="email"></div>
          <div><div class="label">Land</div><input id="billingCountry" class="input" value="DK"></div>
        </div>

        <div class="form-grid">
          <div>
            <div class="label">Lande-kode</div>
            <select id="phonePrefix" class="select">
              <option value="+45">+45 ‚Äî Danmark</option>
            </select>
          </div>
          <div><div class="label">Telefon</div><input id="phoneNumber" class="input"></div>
        </div>

        <input id="nameInput" class="input" style="display:none">

        <button id="nextBtn" class="btn" type="button">Forts√¶t</button>

        <div class="logos">
          <img src="/visa.png"><img src="/mastercard.png"><img src="/amex.png"><img src="/discover.jpg">
        </div>
      </section>

      <!-- STEP 2 -->
      <section id="step2" class="step" aria-hidden="true">
        <div class="h2">2. Betaling</div>
        <p class="sub">Kortoplysninger behandles sikkert af Stripe.</p>

        <div>
          <div class="label">Kortnummer</div><div id="card-number" class="el"></div>
          <div class="form-grid">
            <div><div class="label">Udl√∏bsdato</div><div id="card-expiry" class="el"></div></div>
            <div><div class="label">CVC</div><div id="card-cvc" class="el"></div></div>
          </div>
        </div>

        <div id="err" class="err" aria-hidden="true"></div>

        <div style="display:flex; gap:10px; margin-top:12px">
          <button id="backBtn" class="btn" style="background:#555;width:40%">‚Üê Tilbage</button>
          <button id="payNow" class="btn" style="width:60%">Betal Sikkert</button>
        </div>
      </section>
    </div>

    <!-- RIGHT -->
    <aside>
      <div class="card">
        <div style="font-weight:700;text-align:center">Kundeanmeldelser</div>
        <div style="text-align:center;font-weight:700;">Fenella Lara</div>
        <div style="text-align:center;color:#f6b80c;">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
        <p style="text-align:center;font-size:14px">Min ordre ankom i g√•r. Fantastisk oplevelse!</p>
      </div>

      <div class="card" style="margin-top:14px">
        <div style="font-weight:800;margin-bottom:6px">Ordreoversigt</div>
        <div style="display:flex;justify-content:space-between;border-top:1px dashed #ccc;padding-top:6px">
          <span>Total</span><span>33.95 USD</span>
        </div>
      </div>
    </aside>
  </div>
</div>

<!-- Loading -->
<div id="loading-overlay" class="loading-overlay">
  <div class="loading-box">
    <div class="loading-title">Behandler betaling‚Ä¶</div>
    <div class="progress-wrap"><div class="progress-bar"></div></div>
    <p class="sub">Vent venligst‚Ä¶</p>
  </div>
</div>

<script src="https://js.stripe.com/v3"></script>

<script>
window.addEventListener("DOMContentLoaded", () => {

  const step1 = document.getElementById("step1");
  const step2 = document.getElementById("step2");
  const nextBtn = document.getElementById("nextBtn");
  const backBtn = document.getElementById("backBtn");
  const errBox = document.getElementById("err");

  const firstName = document.getElementById("firstName");
  const lastName = document.getElementById("lastName");
  const nameInput = document.getElementById("nameInput");

  function show(x){ x.setAttribute("aria-hidden","false") }
  function hide(x){ x.setAttribute("aria-hidden","true") }

  nextBtn.addEventListener("click", () => {
    nameInput.value = `${firstName.value} ${lastName.value}`.trim();
    hide(step1); show(step2);
  });

  backBtn.addEventListener("click", () => {
    hide(step2); show(step1);
  });

  /* STRIPE SAME ACCOUNT AS atlas2-cz */
  const stripe = Stripe("pk_live_51SaxeyEV8OvsGiVpMTahrMGQMjZMXD1neiFffQPrybev0TQNcxvVaixH5TfQKzDBNKxLIqcuAgQ1ynYPWXe792D500VQ7Gcw6t");

  const elements = stripe.elements();
  const cardNumber = elements.create("cardNumber");
  const cardExpiry = elements.create("cardExpiry");
  const cardCvc = elements.create("cardCvc");
  cardNumber.mount("#card-number");
  cardExpiry.mount("#card-expiry");
  cardCvc.mount("#card-cvc");

  const payBtn = document.getElementById("payNow");

  payBtn.addEventListener("click", async () => {

    payBtn.disabled = true;
    payBtn.style.opacity = "0.5";
    errBox.setAttribute("aria-hidden", "true");

    const overlay = document.getElementById("loading-overlay");
    overlay.style.display = "flex";

    const name = nameInput.value;
    const email = document.getElementById("emailInput").value;
    const phone = document.getElementById("phoneNumber").value;

    const address = {
      line1: document.getElementById("billingStreet").value,
      city: document.getElementById("billingCity").value,
      postal_code: document.getElementById("billingPostcode").value,
      country: "DK"
    };

    try {
      const pm = await stripe.createPaymentMethod({
        type: "card",
        card: cardNumber,
        billing_details: { name, email, phone, address }
      });

      if (pm.error) throw new Error(pm.error.message);

      const resp = await fetch("/api/stripe/one-time-33-95", {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify({
          paymentMethodId: pm.paymentMethod.id,
          name, email, phone, address
        })
      });

      const data = await resp.json();
      if (!data.clientSecret) throw new Error(data.error || "Kunne ikke starte betaling.");

      const conf = await stripe.confirmCardPayment(data.clientSecret, {
        payment_method: pm.paymentMethod.id
      });

      if (conf.error) throw new Error(conf.error.message);

      if (!conf.paymentIntent || conf.paymentIntent.status !== "succeeded") {
        throw new Error("Betalingen blev ikke gennemf√∏rt.");
      }

      window.location.href = "https://cudsr.bemobtrcks.com/go/e1420adb-fbc5-4cfe-b0f1-10615c05e062";

    } catch (err) {
      errBox.textContent = err.message;
      errBox.setAttribute("aria-hidden", "false");

      payBtn.disabled = false;
      payBtn.style.opacity = "1";
      overlay.style.display = "none";
    }

  });

});
</script>

</body>
</html>
