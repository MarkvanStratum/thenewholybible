<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Secure Checkout</title>
  <meta name="referrer" content="no-referrer">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:400,700,900&display=swap">

  <style>
    body, html { margin: 0; padding: 0; font-family: Inter, sans-serif; background: #fafafa; color: #0a2540; }
    .wrap { max-width: 1100px; margin: auto; padding: 18px 14px 60px; }
    .safe { background: #000; color: #fff; font-size: 12px; padding: 6px 10px; }
    .page-title { font-size: 28px; font-weight: 900; display: flex; gap: 8px; align-items: center; margin: 10px 0; }
    .stars { color: #f6b80c; font-size: 15px; }
    .reviews { color: #5b6b82; font-size: 13px; }
    .grid { display: grid; grid-template-columns: 1fr 360px; gap: 18px; }
    @media(max-width:980px){ .grid { grid-template-columns: 1fr; } }
    .card { background: white; border: 1px solid #e5e7eb; border-radius: 12px; padding: 22px; }
    .h2 { font-size: 18px; font-weight: 800; margin: 10px 0 14px; }
    .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    @media(max-width:620px) { .form-grid { grid-template-columns: 1fr; } }
    .label { font-weight: 700; font-size: 13px; margin: 4px 0; }
    .input { width: 100%; border: 1px solid #cfd6e4; border-radius: 10px; padding: 12px; font-size: 15px; }
    .btn { width: 100%; padding: 12px; font-size: 16px; font-weight: 900; border-radius: 12px; border: none; background: #16a34a; color: white; cursor: pointer; }
    .btn.muted { background: #f1f4f8; color: #20324d; border: 1px solid #e5e7eb; }
    .err { display: none; background: #fff1f1; color: #9a1a1a; padding: 10px; border-radius: 10px; font-size: 14px; margin-top: 10px; border: 1px solid #f5bcbc; }
    .err[aria-hidden="false"] { display: block; }
    .step { display: none; }
    .step[aria-hidden="false"] { display: block; }
    .widget { background: #fff; border: 1px solid #e5e7eb; border-radius: 12px; padding: 16px; margin-bottom: 12px; }
    .delivery { display: flex; align-items: center; gap: 12px; background: #f7fbff; border: 1px dashed #d9e2ef; padding: 12px; border-radius: 10px; }
    .order-row { display: flex; justify-content: space-between; padding: 6px 0; font-size: 14px; border-top: 1px dashed #e6eaf1; }
    .trust { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; text-align: center; }

    #loadingOverlay {
      position: fixed; inset: 0;
      background: rgba(246,249,252,.92);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }
    #loadingOverlay[aria-hidden="false"] { display: flex; }
    .loading-box {
      background: white;
      padding: 24px;
      border-radius: 12px;
      border: 1px solid #e0e0e0;
      text-align: center;
      width: 320px;
    }
  </style>
</head>

<body>
<div class="safe">SSL Secure Checkout</div>

<div class="wrap">
  <div class="page-title">
    üîí Secure Checkout <span class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span><span class="reviews">(2777 reviews)</span>
  </div>

  <div class="grid">
    <div class="card">
      <section id="step1" class="step" aria-hidden="false">
        <div class="h2">1. Shipping Info</div>
        <div class="form-grid">
          <div><div class="label">First Name</div><input id="firstName" class="input"></div>
          <div><div class="label">Last Name</div><input id="lastName" class="input"></div>
        </div>
        <div class="form-grid">
          <div style="grid-column:1/-1"><div class="label">Address</div><input id="billingStreet" class="input"></div>
          <div><div class="label">Postcode</div><input id="billingPostcode" class="input"></div>
          <div><div class="label">City</div><input id="billingCity" class="input"></div>
        </div>
        <div class="form-grid">
          <div><div class="label">Email</div><input id="emailInput" class="input" type="email"></div>
          <div><div class="label">Country</div><input class="input" value="AU" disabled></div>
        </div>
        <button id="nextBtn" class="btn">Continue</button>
      </section>

      <section id="step2" class="step" aria-hidden="true">
        <div class="h2">2. Payment</div>
        <p style="font-size:13px;color:#5b6b82;">Card information is encrypted and securely processed.</p>

        <div id="cashier-iframe-container" style="min-height:420px;"></div>

        <div id="err" class="err" aria-hidden="true"></div>

        <div style="display:flex;gap:10px;margin-top:12px">
          <button id="backBtn" class="btn muted" style="width:40%">‚Üê Back</button>
          <button id="payNow" class="btn" style="width:60%">Pay</button>
        </div>
      </section>
    </div>

    <aside>
      <div class="widget">
        <div style="text-align:center;font-weight:800">Order Summary</div>
        <div class="order-row"><span>Total</span><span>$60.00</span></div>
      </div>
    </aside>
  </div>
</div>

<div id="loadingOverlay" aria-hidden="true">
  <div class="loading-box">
    <div class="loading-title">Processing your payment‚Ä¶</div>
  </div>
</div>

<script src="https://uat-cashier.paytiko.com/sdk/paytiko-sdk.min.js"></script>

<script>
const step1 = document.getElementById("step1");
const step2 = document.getElementById("step2");

nextBtn.onclick = () => {
  step1.setAttribute("aria-hidden","true");
  step2.setAttribute("aria-hidden","false");
};

backBtn.onclick = () => {
  step2.setAttribute("aria-hidden","true");
  step1.setAttribute("aria-hidden","false");
};

payNow.onclick = async () => {
  document.getElementById("loadingOverlay").setAttribute("aria-hidden","false");

  try {
    const res = await fetch("/api/paytiko/checkout", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        firstName: firstName.value,
        lastName: lastName.value,
        email: emailInput.value,
        street: billingStreet.value,
        city: billingCity.value,
        zipCode: billingPostcode.value,
        amount: 60
      })
    });

    const data = await res.json();
    if (!data.sessionToken) throw new Error("Failed to create payment session");

    PaytikoSdk.cashier.invoke({
      environment: "UAT",
      orderId: data.orderId,
      sessionToken: data.sessionToken,
      iframeContainerSelector: "#cashier-iframe-container",
      displayMode: "IFRAME",
      locale: "en-US"
    });

  } catch (e) {
    err.textContent = e.message;
    err.setAttribute("aria-hidden","false");
    document.getElementById("loadingOverlay").setAttribute("aria-hidden","true");
  }
};
</script>

</body>
</html>
